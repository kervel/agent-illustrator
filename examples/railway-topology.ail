// Railway Topology - Three Level Abstraction
// Uses symbolic colors for brand-agnostic theming
// Uses [role: label] for element labels

col diagram {
    // === MICRO LEVEL ===
    group micro {
        // Label using new [role: label] modifier
        col micro_label [role: label] {
            text "Micro" micro_lbl [font_size: 20, fill: text-1]
            text "Detailed tracks" [font_size: 12, fill: text-2]
        }

        row tracks [gap: 50] {
            col entry [gap: 35] {
                circle e1 [fill: accent-1, size: 6]
                circle e2 [fill: accent-1, size: 6]
            }
            col sw1 [gap: 12] {
                circle s1 [fill: accent-1, size: 6]
                circle s2 [fill: accent-1, size: 6]
                circle s3 [fill: accent-1, size: 6]
                circle s4 [fill: accent-1, size: 6]
            }
            col yard [gap: 12] {
                circle y1 [fill: accent-1, size: 6]
                circle y2 [fill: accent-1, size: 6]
                circle y3 [fill: accent-1, size: 6]
                circle y4 [fill: accent-1, size: 6]
            }
            col sw2 [gap: 12] {
                circle t1 [fill: accent-1, size: 6]
                circle t2 [fill: accent-1, size: 6]
                circle t3 [fill: accent-1, size: 6]
                circle t4 [fill: accent-1, size: 6]
            }
            col exit [gap: 35] {
                circle x1 [fill: accent-1, size: 6]
                circle x2 [fill: accent-1, size: 6]
            }

            // Track connections
            e1 -- s1 [stroke: accent-1, routing: direct]
            e1 -- s2 [stroke: accent-1, routing: direct]
            e2 -- s3 [stroke: accent-1, routing: direct]
            e2 -- s4 [stroke: accent-1, routing: direct]
            s1 -- y1 [stroke: accent-1, routing: direct]
            s2 -- y2 [stroke: accent-1, routing: direct]
            s3 -- y3 [stroke: accent-1, routing: direct]
            s4 -- y4 [stroke: accent-1, routing: direct]
            y1 -- t1 [stroke: accent-1, routing: direct]
            y2 -- t2 [stroke: accent-1, routing: direct]
            y3 -- t3 [stroke: accent-1, routing: direct]
            y4 -- t4 [stroke: accent-1, routing: direct]
            t1 -- x1 [stroke: accent-1, routing: direct]
            t2 -- x1 [stroke: accent-1, routing: direct]
            t3 -- x2 [stroke: accent-1, routing: direct]
            t4 -- x2 [stroke: accent-1, routing: direct]
        }
    }

    // === MESO LEVEL ===
    group meso {
        // Label using new [role: label] modifier
        col meso_label [role: label] {
            text "Meso" meso_lbl [font_size: 20, fill: text-1]
            text "OPs + Tracks" [font_size: 12, fill: text-2]
        }

        stack overlay {
            col meso_tracks {
                line m1 [stroke: accent-1]
                line m2 [stroke: accent-1]
                line m3 [stroke: accent-1]
                line m4 [stroke: accent-1]
                line m5 [stroke: accent-1]
            }
            row ops [gap: 10] {
                ellipse op1 [fill: accent-light, opacity: 0.35, label: "OP1"]
                ellipse op2 [fill: accent-light, opacity: 0.35, label: "OP2"]
            }
        }
    }

    // === MACRO LEVEL ===
    group macro {
        // Label using new [role: label] modifier
        col macro_label [role: label] {
            text "Macro" macro_lbl [font_size: 20, fill: text-1]
            text "Nodes & Lines" [font_size: 12, fill: text-2]
        }

        row graph [gap: 30] {
            ellipse n1 [fill: foreground-1, label: "OP1", width: 70, height: 40]
            ellipse n2 [fill: foreground-1, label: "OP2", width: 70, height: 40]
            n1 -- n2 [stroke: accent-1, stroke_width: 3, label: "Line Section", routing: direct]
        }
    }

    // Aggregation arrows with connection label references
    text "Aggregation" agg_label [font_size: 11, fill: foreground-3]
    text "Simplification" simp_label [font_size: 11, fill: foreground-3]
    micro_label -> meso_label [label: agg_label, label_position: right, stroke: foreground-3, routing: direct]
    meso_label -> macro_label [label: simp_label, label_position: right, stroke: foreground-3, routing: direct]

    // Align the level labels on the same vertical axis
    // Align containers for correct arrow routing
    align micro_label.horizontal_center = meso_label.horizontal_center = macro_label.horizontal_center
    // Align text elements for visual alignment
    align micro_lbl.horizontal_center = meso_lbl.horizontal_center = macro_lbl.horizontal_center
}
