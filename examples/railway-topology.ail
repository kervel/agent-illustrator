// Railway Topology - Three Level Abstraction
// Uses symbolic colors for brand-agnostic theming
// Uses [role: label] for element labels

col diagram {
    // === MICRO LEVEL ===
    // 2 main tracks (A and B) with crossover connections
    // Track A: a1 -- jA1 -- jA2 -- a2
    // Track B: b1 -- jB1 -- jB2 -- b2
    // Crossovers: jA1 -> jB1 (left), jB2 -> jA2 (right)
    group micro {
        col micro_label [role: label] {
            text "Micro" micro_lbl [font_size: 20, fill: text-1]
            text "Detailed tracks" [font_size: 12, fill: text-2]
        }

        col tracks [gap: 30] {
            // Track A (top)
            row trackA [gap: 80] {
                circle a1 [fill: accent-1, size: 6]
                circle jA1 [fill: accent-1, size: 6]
                circle jA2 [fill: accent-1, size: 6]
                circle a2 [fill: accent-1, size: 6]
            }
            // Track B (bottom)
            row trackB [gap: 80] {
                circle b1 [fill: accent-1, size: 6]
                circle jB1 [fill: accent-1, size: 6]
                circle jB2 [fill: accent-1, size: 6]
                circle b2 [fill: accent-1, size: 6]
            }

            // Offset top junctions for diagonal crossovers:
            // jA1 offset left → diagonal goes down-right to jB1
            // jA2 offset right → diagonal goes down-left from jB2
            align jA1.horizontal_center = jB1.horizontal_center
            place jA1 [x: -40]
            align jA2.horizontal_center = jB2.horizontal_center
            place jA2 [x: 40]

            // Track A main line
            a1 -- jA1 [stroke: text-1, stroke_width: 2, routing: direct]
            jA1 -- jA2 [stroke: text-1, stroke_width: 2, routing: direct]
            jA2 -- a2 [stroke: text-1, stroke_width: 2, routing: direct]

            // Track B main line
            b1 -- jB1 [stroke: text-1, stroke_width: 2, routing: direct]
            jB1 -- jB2 [stroke: text-1, stroke_width: 2, routing: direct]
            jB2 -- b2 [stroke: text-1, stroke_width: 2, routing: direct]

            // Crossover connections (switches)
            jA1 -- jB1 [stroke: text-1, stroke_width: 2, routing: direct]
            jB2 -- jA2 [stroke: text-1, stroke_width: 2, routing: direct]
        }
    }

    // === MESO LEVEL ===
    group meso {
        // Label using new [role: label] modifier
        col meso_label [role: label] {
            text "Meso" meso_lbl [font_size: 20, fill: text-1]
            text "OPs + Tracks" [font_size: 12, fill: text-2]
        }

        stack overlay {
            col meso_tracks {
                line m1 [stroke: accent-1]
                line m2 [stroke: accent-1]
                line m3 [stroke: accent-1]
                line m4 [stroke: accent-1]
                line m5 [stroke: accent-1]
            }
            row ops [gap: 10] {
                ellipse op1 [fill: accent-light, opacity: 0.35, label: "OP1"]
                ellipse op2 [fill: accent-light, opacity: 0.35, label: "OP2"]
            }
        }
    }

    // === MACRO LEVEL ===
    group macro {
        // Label using new [role: label] modifier
        col macro_label [role: label] {
            text "Macro" macro_lbl [font_size: 20, fill: text-1]
            text "Nodes & Lines" [font_size: 12, fill: text-2]
        }

        row graph [gap: 30] {
            ellipse n1 [fill: foreground-1, label: "OP1", width: 70, height: 40]
            ellipse n2 [fill: foreground-1, label: "OP2", width: 70, height: 40]
            n1 -- n2 [stroke: accent-1, stroke_width: 3, label: "Line Section", routing: direct]
        }
    }

    // Aggregation arrows with connection label references
    text "Aggregation" agg_label [font_size: 11, fill: foreground-3]
    text "Simplification" simp_label [font_size: 11, fill: foreground-3]
    micro_label -> meso_label [label: agg_label, label_position: right, stroke: foreground-3, routing: direct]
    meso_label -> macro_label [label: simp_label, label_position: right, stroke: foreground-3, routing: direct]

    // Align the level labels on the same vertical axis
    // Align containers for correct arrow routing
    align micro_label.horizontal_center = meso_label.horizontal_center = macro_label.horizontal_center
    // Align text elements for visual alignment
    align micro_lbl.horizontal_center = meso_lbl.horizontal_center = macro_lbl.horizontal_center
}
