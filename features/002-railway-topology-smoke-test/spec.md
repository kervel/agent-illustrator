---
parent_branch: main
feature_number: "002"
status: In Progress
created_at: 2026-01-23T12:00:00+01:00
---

# Feature: Railway Topology Smoke Test Illustration

## Overview

Create a reference example illustration that serves as a smoke test for the Agent Illustrator DSL and SVG rendering pipeline. The illustration depicts railway network topology at three abstraction levels (Micro, Meso, Macro), demonstrating hierarchical aggregation from detailed track layouts to simplified network graphs.

This example is ideal as a smoke test because it exercises:
- Multiple shape types (lines, circles, ovals, rectangles)
- Text labels at various positions
- Hierarchical grouping (three distinct levels)
- Connection/relationship representation (aggregation arrows)
- Semantic layout (vertical stacking with flow arrows)
- Overlapping elements (tracks passing through operational point regions)

The original image was generated by an AI agent but contains factual inaccuracies in how it represents railway topology concepts. This smoke test will produce a corrected, accurate version.

## Reference Image Analysis

The target illustration shows:

1. **Micro Level** (top): Detailed track geometry showing multiple parallel tracks with switches, crossovers, and junctions. Blue lines represent individual tracks.

2. **Meso Level** (middle): Two overlapping semi-transparent green circles labeled "OP1" and "OP2" (Operational Points). The same track geometry passes through these regions, showing how micro-level detail is grouped into operational points.

3. **Macro Level** (bottom): A simplified graph with two green ovals (OP1, OP2) connected by blue lines labeled "Line Section". This represents the abstract network topology.

4. **Aggregation Arrows**: Gray downward arrows between levels labeled "Aggregation" showing the transformation from detailed to abstract.

## User Scenarios

### Scenario 1: DSL Produces Valid SVG Output
A user writes DSL code describing the railway topology diagram. The system parses it, applies layout, and renders a valid SVG file that displays correctly in browsers.

**Acceptance Criteria:**
- DSL code compiles without errors
- Output is valid SVG 1.1
- SVG renders correctly in modern browsers (Chrome, Firefox, Safari)
- All text labels are readable
- Colors match specification (blue tracks, green operational points, gray arrows)

### Scenario 2: Hierarchical Layout is Correct
The three topology levels are arranged vertically with appropriate spacing, and aggregation arrows connect them visually.

**Acceptance Criteria:**
- Micro level appears at top
- Meso level appears in middle
- Macro level appears at bottom
- Aggregation arrows point downward between levels
- Spacing between levels is visually balanced

### Scenario 3: Track Geometry Renders Accurately
The micro-level track layout shows parallel tracks with switches and crossovers as connected line segments.

**Acceptance Criteria:**
- Multiple parallel horizontal tracks are visible
- Switch/junction points show track divergence
- Line segments connect smoothly at junctions
- Track lines have consistent stroke width

### Scenario 4: Operational Points Display Correctly
The meso-level operational points appear as labeled, semi-transparent regions that overlay the track geometry.

**Acceptance Criteria:**
- OP1 and OP2 regions are visually distinct
- Regions use semi-transparent fill
- Labels "OP1" and "OP2" are centered in their regions
- Track geometry is visible through the semi-transparent regions

### Scenario 5: Macro Graph is Simplified
The macro level shows only nodes (operational points) and edges (line sections) without track detail.

**Acceptance Criteria:**
- OP1 and OP2 appear as solid oval shapes
- Line sections connect the ovals
- "Line Section" labels appear on connecting lines
- No micro-level track detail is visible at this level

## Functional Requirements

### FR-1: Three-Level Vertical Layout
The illustration must arrange three distinct sections vertically.

**Requirement:** The DSL must express three groups (micro, meso, macro) arranged in a vertical column layout.
**Testable Criterion:** Generated SVG has three visually distinct horizontal bands stacked vertically.

### FR-2: Level Labels
Each topology level must be labeled on the left side.

**Requirement:** Text labels "Micro", "Meso", and "Macro" appear aligned to the left of their respective sections.
**Testable Criterion:** SVG contains text elements with these labels positioned to the left of each section.

### FR-3: Aggregation Flow Arrows
Downward arrows must connect the levels with "Aggregation" labels.

**Requirement:** Gray arrows with "Aggregation" labels connect Micro→Meso and Meso→Macro.
**Testable Criterion:** SVG contains arrow shapes pointing downward between sections, with associated text labels.

### FR-4: Track Geometry (Micro Level)
The micro level must show interconnected track lines.

**Requirement:** Multiple horizontal lines with branching/merging points representing railway tracks and switches.
**Testable Criterion:** SVG contains polyline or path elements forming a track network pattern.

### FR-5: Operational Point Regions (Meso Level)
The meso level must show labeled circular/elliptical regions.

**Requirement:** Two overlapping semi-transparent regions labeled "OP1" and "OP2" with track geometry visible through them.
**Testable Criterion:** SVG contains circle or ellipse elements with opacity < 1 and text labels.

### FR-6: Network Graph (Macro Level)
The macro level must show a simplified node-edge graph.

**Requirement:** Two oval nodes (OP1, OP2) connected by labeled edges ("Line Section").
**Testable Criterion:** SVG contains ellipse elements for nodes and line elements for edges with text labels.

### FR-7: Consistent Color Scheme
The illustration must use a consistent color palette.

**Requirement:**
- Tracks: Blue (#4A90D9 or similar)
- Operational Points: Green (#8BC34A or similar) with transparency
- Arrows/Labels: Gray (#666666 or similar)
- Background: White or transparent

**Testable Criterion:** SVG element fill and stroke attributes match the specified color scheme.

### FR-8: DSL Expressiveness Test
The DSL code for this illustration must be readable and maintainable.

**Requirement:** The complete illustration can be expressed in under 100 lines of DSL code.
**Testable Criterion:** Source DSL file line count is less than 100.

## Success Criteria

1. **Rendering Correctness**: The generated SVG visually matches the reference layout with all elements present and correctly positioned
2. **DSL Clarity**: A developer unfamiliar with the DSL can understand the illustration structure by reading the source code
3. **Round-Trip Validation**: The DSL parses without errors and produces valid SVG output
4. **Browser Compatibility**: SVG displays correctly in Chrome, Firefox, and Safari
5. **File Size Efficiency**: Generated SVG is under 50KB for this illustration complexity

## Key Entities

### TopologyLevel
A horizontal band representing one abstraction level (micro, meso, or macro) with its contained elements.

### Track
A line segment or polyline representing railway track geometry at the micro level.

### OperationalPoint
A named region (OP1, OP2) that groups micro-level tracks into a logical unit at the meso level.

### LineSection
An edge in the macro-level graph connecting two operational points.

### AggregationArrow
A visual connector showing the transformation relationship between adjacent topology levels.

### Label
Text annotation for levels, operational points, or line sections.

## Assumptions

1. **Static Illustration**: No animation or interactivity required
2. **Single Output Format**: SVG 1.1 is the only required output format
3. **Fixed Dimensions**: Target canvas size is approximately 1024x1024 pixels (matching reference)
4. **Left-to-Right Reading**: Labels and text flow left-to-right (Western reading order)
5. **Simplified Track Geometry**: Exact track topology is illustrative, not based on real railway data
6. **Two Operational Points**: The example uses exactly two OPs; extensibility to more is not required for this smoke test

## Out of Scope

- Interactive SVG features (hover, click handlers)
- Multiple output formats (PNG, PDF)
- Real railway data import
- Animation of aggregation process
- Accessibility features (ARIA labels) - may be added in future iteration
